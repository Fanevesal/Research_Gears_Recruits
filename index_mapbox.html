<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Distance with Mapbox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin:0; font-family:sans-serif; background:#111; color:#eee; }
    #map { width:100%; height:85vh; }
    .panel {
      display:flex; gap:8px; align-items:center;
      padding:10px; background:#222; border-bottom:1px solid #333;
    }
    input { padding:6px; border:none; border-radius:4px; width:200px; }
    button { padding:6px 12px; background:#00aaff; color:#fff; border:none; border-radius:4px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="panel">
    <input id="start" placeholder="Start lat,lng">
    <input id="end" placeholder="End lat,lng">
    <button onclick="measure()">Measure</button>
    <span id="result"></span>
  </div>
  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZmFuZXZlc2FsIiwiYSI6ImNtZWNpcnUzOTBuNWsya3Njc2NkeWwwa2YifQ._LFk6HbPjUmwy4sHnpH0jA';
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v11', // black & white style
      center: [39.2083, -6.7924],
      zoom: 10
    });

    async function measure() {
      const start = document.getElementById('start').value.split(',').map(Number);
      const end = document.getElementById('end').value.split(',').map(Number);
      if (start.length !== 2 || end.length !== 2 || start.some(isNaN) || end.some(isNaN)) {
        alert('Enter coordinates as "lat,lng"');
        return;
      }

      const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${start[1]},${start[0]};${end[1]},${end[0]}?geometries=geojson&access_token=${mapboxgl.accessToken}`;
      const rsp = await fetch(url);
      const json = await rsp.json();

      if (!json.routes?.length) {
        alert("No route found.");
        return;
      }

      const route = json.routes[0].geometry;
      const distanceKm = (json.routes[0].distance / 1000).toFixed(2);
      document.getElementById('result').textContent = `Distance: ${distanceKm} km`;

      const routeData = {
        type: 'Feature',
        geometry: route
      };

      // Update if exists, else add
      if (map.getSource('route')) {
        map.getSource('route').setData(routeData);
      } else {
        map.addSource('route', { type: 'geojson', data: routeData });
        map.addLayer({
          id: 'route',
          type: 'line',
          source: 'route',
          layout: { 'line-join': 'round', 'line-cap': 'round' },
          paint: { 'line-color': '#33ccff', 'line-width': 5 }
        });
      }

      const bounds = new mapboxgl.LngLatBounds();
      route.coordinates.forEach(c => bounds.extend(c));
      map.fitBounds(bounds, { padding: 50 });
    }
  </script>
</body>
</html>